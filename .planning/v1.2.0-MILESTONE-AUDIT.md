---
milestone: v1.2.0
audited: 2026-02-28T09:00:00Z
status: gaps_found
scores:
  requirements: 14/18
  phases: 2/3
  integration: 14/18
  flows: 7/10
gaps:
  requirements:
    - id: "MCP-01"
      status: "orphaned"
      phase: "Phase 3"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 3 directory does not exist in .planning/phases/. No plans created, no verification performed. Requirement assigned in REQUIREMENTS.md traceability but has no phase implementation."
    - id: "MCP-02"
      status: "orphaned"
      phase: "Phase 3"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 3 directory does not exist. serverProvisionSchema has no mode field; MCP provision always creates Coolify servers."
    - id: "MCP-03"
      status: "orphaned"
      phase: "Phase 3"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 3 directory does not exist. MCP error format alignment not implemented."
    - id: "MCP-04"
      status: "orphaned"
      phase: "Phase 3"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 3 directory does not exist. MCP schema backward-compat not yet verifiable."
  integration:
    - from: "Phase 2 (bare mode)"
      to: "MCP serverProvision"
      issue: "serverProvisionSchema has no mode field; provisionServer called without mode parameter. MCP always provisions Coolify servers."
      affected_requirements: ["MCP-02", "BARE-01"]
    - from: "Phase 2 (bare mode)"
      to: "MCP serverManage add"
      issue: "serverManageSchema has no mode field; addServerRecord called without mode. Bare servers registered via MCP get mode:coolify, defeating all bare-mode guards."
      affected_requirements: ["MCP-02", "BARE-08"]
    - from: "Phase 2 (bare mode)"
      to: "MCP serverInfo health"
      issue: "Health action calls checkCoolifyHealth directly without isBareServer guard. Bare servers always reported as 'not reachable'. formatServerList omits mode field."
      affected_requirements: ["MCP-01", "BARE-02"]
    - from: "Phase 2 (bare mode)"
      to: "MCP serverBackup"
      issue: "Always routes to Coolify backup/restore (createBackup/restoreBackup). No isBareServer branch. Bare server backup via MCP attempts pg_dump in non-existent Docker container."
      affected_requirements: ["MCP-01", "BARE-07"]
  flows:
    - flow: "Bare server provisioned via MCP"
      breaks_at: "serverProvision.ts:63 — mode field absent from ProvisionConfig call"
      affected_requirements: ["MCP-02"]
    - flow: "Bare server status checked via MCP"
      breaks_at: "serverInfo.ts:205,226 — checkCoolifyHealth called without isBareServer guard"
      affected_requirements: ["BARE-02", "MCP-01"]
    - flow: "Bare server backed up via MCP"
      breaks_at: "serverBackup.ts:90 — missing isBareServer branch, Coolify backup always called"
      affected_requirements: ["BARE-07", "MCP-01"]
tech_debt:
  - phase: 01-cli-core-refactor
    items:
      - "maintain.ts retains ~50 lines of inline provider reboot/polling logic (accepted deviation — interactive orchestration)"
      - "SUMMARY frontmatter requirements_completed empty for all 5 plans (documentation gap, not functional)"
      - "REF-01 and REF-03 traceability table status says 'Partial' but should be 'Complete' (stale update)"
  - phase: 02-bare-mode
    items:
      - "SUMMARY frontmatter requirements_completed empty for all 4 plans (documentation gap, not functional)"
      - "restore.ts:48 checks process.env.SAFE_MODE while isSafeMode() checks QUICKLIFY_SAFE_MODE (pre-existing env var split)"
---

# v1.2.0 Milestone Audit Report

**Milestone:** v1.2.0 — Generic Server Management
**Audited:** 2026-02-28T09:00:00Z
**Status:** GAPS FOUND
**Score:** 14/18 requirements satisfied

---

## Phase Summary

| Phase | Status | Verification | Tests | Score |
|-------|--------|-------------|-------|-------|
| Phase 1: CLI/Core Refactor | PASSED | 13/13 must-haves | 1755 passing | 5/5 REF requirements |
| Phase 2: Bare Mode | PASSED | 5/5 must-haves | 1871 passing | 9/9 BARE requirements |
| Phase 3: MCP Refactor | NOT STARTED | No verification | N/A | 0/4 MCP requirements |

---

## Requirements Coverage (3-Source Cross-Reference)

### Phase 1: REF Requirements

| REQ-ID | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------------------|-----------------|--------------|
| REF-01 | SATISFIED | missing (empty) | [x] | **satisfied** |
| REF-02 | SATISFIED | missing (empty) | [x] | **satisfied** |
| REF-03 | SATISFIED | missing (empty) | [x] | **satisfied** |
| REF-04 | SATISFIED | missing (empty) | [x] | **satisfied** |
| REF-05 | SATISFIED | missing (empty) | [x] | **satisfied** |

### Phase 2: BARE Requirements

| REQ-ID | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------------------|-----------------|--------------|
| BARE-01 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-02 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-03 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-04 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-05 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-06 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-07 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-08 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-09 | SATISFIED | missing (empty) | [x] | **satisfied** |

### Phase 3: MCP Requirements (ORPHANED)

| REQ-ID | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------------------|-----------------|--------------|
| MCP-01 | orphaned (no phase dir) | N/A | [ ] Pending | **unsatisfied** |
| MCP-02 | orphaned (no phase dir) | N/A | [ ] Pending | **unsatisfied** |
| MCP-03 | orphaned (no phase dir) | N/A | [ ] Pending | **unsatisfied** |
| MCP-04 | orphaned (no phase dir) | N/A | [ ] Pending | **unsatisfied** |

**Orphan Detection:** MCP-01 through MCP-04 are assigned to Phase 3 in REQUIREMENTS.md traceability table but Phase 3 has no directory, no plans, no VERIFICATION.md, no SUMMARY files. These are orphaned requirements treated as unsatisfied per audit protocol.

---

## Cross-Phase Integration

### Connected Exports (Phase 1 → Phase 2): CLEAN

All Phase 1 core/ exports properly consumed by Phase 2:
- `src/constants.ts` → init.ts, provision.ts, maintain.ts, status.ts
- `src/types/index.ts` (ServerRecord, ServerMode) → manage.ts, provision.ts, modeGuard.ts, config.ts
- `src/core/manage.ts` (addServerRecord) → add.ts with mode parameter
- `src/core/status.ts` (checkCoolifyHealth) → status.ts with isBareServer guard
- `src/core/backup.ts` extended with createBareBackup, restoreBareBackup
- `src/core/provision.ts` extended with bare cloud-init selection

### MCP Integration Gaps (4 findings — all Phase 3 scope)

| # | Gap | From → To | Affected REQs |
|---|-----|-----------|---------------|
| 1 | serverProvisionSchema has no `mode` field | Phase 2 → MCP serverProvision | MCP-02, BARE-01 |
| 2 | serverManageSchema add has no `mode` field | Phase 2 → MCP serverManage | MCP-02, BARE-08 |
| 3 | serverInfo health calls checkCoolifyHealth without isBareServer guard | Phase 2 → MCP serverInfo | MCP-01, BARE-02 |
| 4 | serverBackup always routes to Coolify backup (no bare branch) | Phase 2 → MCP serverBackup | MCP-01, BARE-07 |

### Security Finding (Pre-existing)

`src/commands/restore.ts:48` checks `process.env.SAFE_MODE` while the canonical `isSafeMode()` in `src/core/manage.ts:11` checks `process.env.QUICKLIFY_SAFE_MODE`. Setting the documented variable does NOT block the CLI restore command. This predates Phase 2.

---

## E2E Flow Status

### Complete Flows (7/10)

| Flow | Path | Status |
|------|------|--------|
| `quicklify init --mode bare` | init.ts → getBareCloudInit → provisionServer(bare) → SaveRecord(bare) | COMPLETE |
| `quicklify status <bare-server>` | status.ts → isBareServer → SSH info, no Coolify check | COMPLETE |
| `quicklify add --mode bare` | add.ts → addServerRecord(bare) → record saved mode:bare | COMPLETE |
| `quicklify backup <bare-server>` | backup.ts → isBareServer → createBareBackup → tar config | COMPLETE |
| `quicklify restore <bare-server>` | restore.ts → isBareServer → restoreBareBackup → extract | COMPLETE |
| `quicklify update <bare-server>` | update.ts → requireCoolifyMode → error, exits early | COMPLETE |
| `quicklify maintain <bare-server>` | maintain.ts → requireCoolifyMode → error, exits early | COMPLETE |

### Broken Flows (3/10) — All MCP paths (Phase 3 scope)

| Flow | Breaks At | Affected REQs |
|------|-----------|---------------|
| Bare server provisioned via MCP | serverProvision.ts:63 — mode absent | MCP-02 |
| Bare server status via MCP | serverInfo.ts:205 — no isBareServer guard | BARE-02, MCP-01 |
| Bare server backup via MCP | serverBackup.ts:90 — no bare branch | BARE-07, MCP-01 |

---

## Tech Debt

### Phase 1: CLI/Core Refactor (3 items)

- maintain.ts retains ~50 lines of inline provider reboot/polling logic (accepted deviation — interactive orchestration)
- SUMMARY frontmatter `requirements_completed` empty for all 5 plans (documentation gap)
- REF-01, REF-03 traceability table status says "Partial" but should be "Complete" (stale update)

### Phase 2: Bare Mode (2 items)

- SUMMARY frontmatter `requirements_completed` empty for all 4 plans (documentation gap)
- restore.ts:48 checks `SAFE_MODE` while canonical `isSafeMode()` checks `QUICKLIFY_SAFE_MODE` (pre-existing env var split)

### Total: 5 items across 2 phases

---

## Conclusion

Phases 1 and 2 are fully verified with all 14 requirements satisfied. Phase 3 (MCP Refactor) has not been started — its 4 requirements (MCP-01 through MCP-04) are orphaned. All 3 broken E2E flows are in the MCP layer and scoped to Phase 3 work.

The milestone cannot be marked as `passed` until Phase 3 is planned, executed, and verified, OR the MCP requirements are explicitly descoped from v1.2.0.

---

_Audited: 2026-02-28T09:00:00Z_
_Auditor: Claude (milestone-audit orchestrator)_
