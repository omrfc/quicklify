---
milestone: v1.2.0
audited: 2026-02-28T11:00:00Z
status: tech_debt
scores:
  requirements: 18/18
  phases: 3/3
  integration: 25/28
  flows: 4/5
gaps:
  requirements: []
  integration:
    - from: "Phase 3 MCP utils"
      to: "MCP tools"
      issue: "requireProviderToken exported from src/mcp/utils.ts but never imported — serverBackup.ts defines local requireToken() duplicate; serverMaintain.ts and serverInfo.ts call getProviderToken directly"
      affected_requirements: ["MCP-03"]
    - from: "Phase 1 types"
      to: "core/ modules"
      issue: "QuicklifyResult<T> defined in src/types/index.ts but not imported by any core/ module — each module defines own result interface"
      affected_requirements: ["REF-03"]
    - from: "Phase 2 bare mode"
      to: "CLI/MCP domain commands"
      issue: "Domain commands interact with Coolify DB but lack isBareServer() guard — bare server domain-set produces confusing SSH error instead of clear mode-mismatch message"
      affected_requirements: ["BARE-06"]
  flows:
    - flow: "Bare server backup restore mode mismatch"
      breaks_at: "restoreBareBackup does not validate BackupManifest.mode field — restoring Coolify backup on bare server produces opaque 'Missing file: bare-config.tar.gz' error instead of clear mode-mismatch"
      affected_requirements: ["BARE-07"]
tech_debt:
  - phase: 01-cli-core-refactor
    items:
      - "maintain.ts retains ~50 lines of inline provider reboot/polling logic (accepted deviation — interactive orchestration)"
      - "SUMMARY frontmatter requirements_completed empty for all 5 plans (documentation gap)"
      - "REF-01 and REF-03 traceability table status says 'Partial' but should be 'Complete' (stale update)"
  - phase: 02-bare-mode
    items:
      - "SUMMARY frontmatter requirements_completed empty for all 4 plans (documentation gap)"
      - "Human verification items deferred: interactive init --mode bare flow and live bare backup/restore"
  - phase: 03-mcp-refactor
    items:
      - "SUMMARY frontmatter requirements_completed empty for all 3 plans (documentation gap)"
      - "serverMaintain.ts maintain action uses raw content construction instead of mcpSuccess() (inconsistent with other tools)"
      - "4/7 MCP tools construct raw {content, isError} objects for some error paths instead of using mcpError()"
---

# v1.2.0 Milestone Audit Report

**Milestone:** v1.2.0 — Generic Server Management
**Audited:** 2026-02-28T11:00:00Z
**Status:** TECH DEBT (no blockers, accumulated items need review)
**Score:** 18/18 requirements satisfied

---

## Phase Summary

| Phase | Status | Verification | Tests | Score |
|-------|--------|-------------|-------|-------|
| Phase 1: CLI/Core Refactor | PASSED | 13/13 must-haves | 1755 passing | 5/5 REF requirements |
| Phase 2: Bare Mode | PASSED | 5/5 must-haves | 1871 passing | 9/9 BARE requirements |
| Phase 3: MCP Refactor | PASSED | 12/12 must-haves (re-verified) | 1921 passing | 4/4 MCP requirements |

**All 3 phases verified and passed.**

---

## Requirements Coverage (3-Source Cross-Reference)

### Phase 1: REF Requirements

| REQ-ID | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------------------|-----------------|--------------|
| REF-01 | SATISFIED | missing (empty) | [x] | **satisfied** |
| REF-02 | SATISFIED | missing (empty) | [x] | **satisfied** |
| REF-03 | SATISFIED | missing (empty) | [x] | **satisfied** |
| REF-04 | SATISFIED | missing (empty) | [x] | **satisfied** |
| REF-05 | SATISFIED | missing (empty) | [x] | **satisfied** |

### Phase 2: BARE Requirements

| REQ-ID | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------------------|-----------------|--------------|
| BARE-01 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-02 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-03 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-04 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-05 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-06 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-07 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-08 | SATISFIED | missing (empty) | [x] | **satisfied** |
| BARE-09 | SATISFIED | missing (empty) | [x] | **satisfied** |

### Phase 3: MCP Requirements

| REQ-ID | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------------------|-----------------|--------------|
| MCP-01 | SATISFIED | missing (empty) | [x] | **satisfied** |
| MCP-02 | SATISFIED | missing (empty) | [x] | **satisfied** |
| MCP-03 | SATISFIED | missing (empty) | [x] | **satisfied** |
| MCP-04 | SATISFIED | missing (empty) | [x] | **satisfied** |

**Note on SUMMARY frontmatter:** All 12 plan SUMMARYs have empty `requirements_completed: []`. This is a documentation gap — the executors did not populate this field during plan execution. Requirements were verified through VERIFICATION.md (detailed evidence with file:line references) and REQUIREMENTS.md checkboxes (all [x]). Both primary sources confirm all 18 requirements are substantively satisfied.

**Note on traceability table:** REF-01 and REF-03 traceability status text says "Partial" but this is stale — it was last updated after Plan 01-04 but before Plan 01-05 completed the remaining refactoring. The checkbox is [x] and VERIFICATION.md confirms SATISFIED.

**Orphaned Requirements:** None. All 18 requirements are mapped to phases and verified.

---

## Cross-Phase Integration

### Connected Exports: 25/28

All critical cross-phase dependencies are properly wired:

**Phase 1 → Phase 2:**
- `src/constants.ts` → init.ts, provision.ts, maintain.ts, status.ts
- `src/types/index.ts` (ServerRecord, ServerMode) → manage.ts, provision.ts, modeGuard.ts, config.ts
- `src/core/manage.ts` (addServerRecord, destroyCloudServer) → commands with mode parameter
- `src/core/status.ts` (checkCoolifyHealth) → status.ts with isBareServer guard
- `src/core/backup.ts` extended with createBareBackup/restoreBareBackup
- `src/core/provision.ts` extended with bare cloud-init selection

**Phase 2 → Phase 3:**
- `src/utils/modeGuard.ts` (isBareServer, requireCoolifyMode, getServerMode) → all 7 MCP tools
- `src/core/backup.ts` (createBareBackup, restoreBareBackup) → serverBackup MCP tool
- `src/utils/cloudInit.ts` (getBareCloudInit) → serverProvision via core/provision.ts

**Phase 1 → Phase 3:**
- All core/ modules → MCP tools via shared `src/mcp/utils.ts` (resolveServerForMcp, mcpSuccess, mcpError)

### Orphaned Exports: 3/28

| # | Export | File | Issue | Severity |
|---|--------|------|-------|----------|
| 1 | `requireProviderToken` | src/mcp/utils.ts:75-88 | Exported but never imported. serverBackup.ts has local duplicate `requireToken()`. Other tools call getProviderToken directly. | Warning |
| 2 | `QuicklifyResult<T>` | src/types/index.ts:145-150 | Defined as standard result type but no core/ module imports it. Each module defines own result interface. | Warning |
| 3 | Domain commands | commands/domain.ts, mcp/tools/serverSecure.ts | No `isBareServer()` guard before Coolify DB operations. Bare server domain-set produces confusing SSH error. | Warning |

### SAFE_MODE Protection: Complete

All destructive operations properly guarded:
- server_provision: isSafeMode() ✓
- server_manage destroy: isSafeMode() ✓
- server_maintain restart: isSafeMode() ✓
- server_maintain maintain: isSafeMode() ✓
- server_backup backup-restore: isSafeMode() ✓
- server_backup snapshot-create: isSafeMode() ✓
- server_backup snapshot-delete: isSafeMode() ✓
- commands/restore.ts: isSafeMode() ✓ (Phase 3 fixed this — was checking process.env.SAFE_MODE)

---

## E2E Flow Status

### Complete Flows (4/5)

| Flow | Path | Status |
|------|------|--------|
| Bare provision (CLI) | init --mode bare → getBareCloudInit → provisionServer(bare) → SaveRecord(bare) | COMPLETE |
| Bare provision (MCP) | server_provision {mode:"bare"} → provisionServer(bare) → server_info(status) → server_backup → server_manage(destroy) | COMPLETE |
| Coolify backward compat | getServers() defaults mode to "coolify" → all isBareServer() guards return false → existing flow unchanged | COMPLETE |
| Config migration | Legacy ServerRecord (no mode field) → getServers() normalizes to mode:"coolify" at read time | COMPLETE |

### Partial Flow (1/5)

| Flow | Issue | Severity |
|------|-------|----------|
| Bare backup/restore mode mismatch | restoreBareBackup does not validate BackupManifest.mode. Restoring a Coolify backup on a bare server produces "Missing file: bare-config.tar.gz" instead of a clear mode-mismatch error. The error is correct but opaque. | Warning |

---

## Tech Debt

### Phase 1: CLI/Core Refactor (3 items)

- maintain.ts retains ~50 lines of inline provider reboot/polling logic (accepted deviation — interactive orchestration)
- SUMMARY frontmatter `requirements_completed` empty for all 5 plans (documentation gap)
- REF-01, REF-03 traceability table status says "Partial" but should be "Complete" (stale update)

### Phase 2: Bare Mode (2 items)

- SUMMARY frontmatter `requirements_completed` empty for all 4 plans (documentation gap)
- Human verification items deferred: interactive init --mode bare flow and live bare backup/restore on real VPS

### Phase 3: MCP Refactor (3 items)

- SUMMARY frontmatter `requirements_completed` empty for all 3 plans (documentation gap)
- serverMaintain.ts maintain action uses raw content construction instead of mcpSuccess() (inconsistent)
- 4/7 MCP tools construct raw `{content, isError}` objects for some error paths instead of using mcpError()

### Total: 8 items across 3 phases

---

## Conclusion

All 18 requirements are functionally satisfied with detailed evidence in VERIFICATION.md reports. All 3 phases passed verification. The milestone goal — "Break Coolify dependency by introducing --mode bare, eliminate CLI/MCP code duplication by routing through core/, and improve MCP provision flow" — is achieved.

The accumulated tech debt is non-critical: 3 orphaned exports, 1 partial flow (opaque error message), documentation gaps in SUMMARY frontmatter, and minor style inconsistencies in MCP error handling. None of these prevent the milestone from being completed.

---

_Audited: 2026-02-28T11:00:00Z_
_Auditor: Claude (milestone-audit orchestrator)_
